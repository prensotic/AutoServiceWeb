@model AutoServiceWeb.Models.Service
@{
    Layout = "_DashboardLayout";
}

<form class="service_form" method="post" enctype="multipart/form-data">
    <input type="hidden" name="Id" value="@Model.Id" />

    <div>
        <h1>Редактирование услуги</h1>

        <div>
            <input name="Title" value="@Model.Title" />
        </div>
        <div>
            <input name="Price" type="number" value="@Model.Price" />
        </div>
        <div>
            <input name="Discount" type="number" max="100" min="0" value="@Model.Discount" />
        </div>
        <div>
            <input name="Time" value="@Model.Time" />
        </div>

        <div>
            <label>Главное изображение</label><br/>
            <div id="mainImagePreview" style="margin-top:10px;">
                @if (!string.IsNullOrEmpty(Model.MainImage))
                {
                    <img src="@Model.MainImage" width="150" />
                }
            </div>
            <input type="file" name="MainImageFile" accept="image/*" onchange="previewMainImage(event)" />
        </div>

        <div>
            <label>Дополнительные изображения</label><br/>
            <input type="file" name="additionalImages" multiple accept="image/*" onchange="previewAdditionalImages(event)" />
        </div>
        <div id="previewContainer" style="margin-top:10px;"></div>

        @if (Model.AdditionalImages != null && Model.AdditionalImages.Any())
        {
            <h3>Текущие изображения:</h3>
            <div>
                @foreach (var img in Model.AdditionalImages)
                {
                    <div class="additional_image">
                        <a asp-action="DeleteServiceImage" asp-route-id="@img.Id" class="btn btn-danger btn-sm"><img src="@img.ImagePath" width="100" /></a>
                    </div>
                }
            </div>
        }

        <div class="service_buttons" style="margin-top:20px;">
            <button type="submit">Изменить</button>
        </div>
    </div>
</form>

<script>
    function previewMainImage(event) {
        const file = event.target.files[0];
        const container = document.getElementById('mainImagePreview');
        container.innerHTML = '';
        if (file) {
            const img = document.createElement('img');
            img.src = URL.createObjectURL(file);
            img.width = 150;
            container.appendChild(img);
        }
    }

    function previewAdditionalImages(event) {
        const files = event.target.files;
        const container = document.getElementById('previewContainer');
        container.innerHTML = '';
        for (let i = 0; i < files.length; i++) {
            const img = document.createElement('img');
            img.src = URL.createObjectURL(files[i]);
            img.width = 100;
            img.style.margin = '5px';
            container.appendChild(img);
        }
    }
</script>
